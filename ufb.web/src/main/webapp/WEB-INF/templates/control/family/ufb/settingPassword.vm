<!DOCTYPE html>
<html>
<head>
    <title>幼富通 - 账户管理 - 密码设置</title>
	<script>
$(function(){
	//页面初始化 
	$("form input[type=text],input[type=password]").each(function () {
        var _this = $(this);
		if(_this.val()!="") {
            _this.siblings(".tips-normal").hide();
        }
    });
	
	//修改登录密码按钮
	$("#btn-settingLoginPwd").on("click",function(){
		if(!check_null($("#login_password0"), "密码不能为空")){
			return false;
		}
		if(!check_pwd1($("#login_password1"))){
			return false;
		}
		if(!check_pwd2($("#login_password2"))){
			return false;
		}
		var errLen = $("#form-settingLoginPwd ul li.error").length;
		if(errLen>0){
			$("ul li.error:eq(0) input[type=text]").focus();
			$("ul li.error:eq(0) input[type=password]").focus();
		}else{
			$("#form-settingLoginPwd").submit();
		}
	});
	
	#if($S_CUSTINFO.tradepwd)
	//修改交易密码按钮
	$("#btn-settingTradePwd").on("click",function(){
		
		if(!check_null($("#trade_password0"), "密码不能为空")){
			return false;
		}
		if(!check_pwd1($("#trade_password1"))){
			return false;
		}
		if(!check_pwd2($("#trade_password2"))){
			return false;
		}
		var errLen = $("#form-settingTradePwd ul li.error").length;
		if(errLen>0){
			$("ul li.error:eq(0) input[type=text]").focus();
			$("ul li.error:eq(0) input[type=password]").focus();
		}else{
			$("#form-settingTradePwd").submit();
		}
	});
	//找回交易密码按钮
	$("#btn-settingTradePwd-back").on("click",function(){
		if(!check_phoneCode($("#msgcode"))){
			return false;
		}
		if(!check_pwd1($("#trade_password1_back"))){
			return false;
		}
		if(!check_pwd2($("#trade_password2_back"))){
			return false;
		}
		var errLen = $("#form-settingTradePwd-back ul li.error").length;
		if(errLen>0){
			$("ul li.error:eq(0) input[type=text]").focus();
			$("ul li.error:eq(0) input[type=password]").focus();
		}else{
			$("#form-settingTradePwd-back").submit();
		}
	});
	#end
	// btn-getMsgCode
	var countDown;
	$("#btn-getMsgCode").on("click",function(){
        $.ajax({
     		type: "GET",
    		url: "../family/getMsgCode.ajax",
    		data: {
			    mobileno: $("#mobileno").val(),
				verifycode: $("#verifycode").val()
    		},
    		dataType: "json",
    		success: function(b) {
                if (b.errCode == "0000") {
					alert("手机验证码已发送");
					// 倒计时
					var count = 60;
            		var countdown = setTimeout(countDown, 1000);
            		$("#btn-getMsgCode").addClass("off");
            		$("#btn-getMsgCode").attr("disabled","disabled");
					// TODO
					$("#msgcode").val(b.TODO);
            		$("#msgcode").siblings(".tips-normal").hide();
					//
            		function countDown() {
            			$("#btn-getMsgCode").prop("disabled", true); 
            			$("#btn-getMsgCode").val("等待" + count + "秒!"); 
            			if (count == 0) { 
            				$("#btn-getMsgCode").val("重新发送"); 
            				$("#btn-getMsgCode").removeClass("off");
            				$("#btn-getMsgCode").removeAttr("disabled"); 
            				clearTimeout(countdown); 
            			}else{
            				count--; 
            				setTimeout(countDown, 1000);
            			}
            		}
                } else {
                  	var errCode = b.errCode;
					var errMsg = b.errMsg;
					//alert(errCode + ": " + errMsg);
					if("errMsg_verifycode"==errCode || "errMsg_mobileno"==errCode){
						$("#errMsg_verifycode").removeClass("ok").addClass("error");
						$("#errMsg_verifycode > .tips-check").html("<i class=icon></i>" + errMsg);
					}else{
						alert(errMsg);
					}
					var src = $("#btn-verifycode").attr("src");
					$("#btn-verifycode").attr("src",src +'?time='+(new Date()));
                }
        	}
        });
	});
	
 #if("2"==$TAB || "2S"==$TAB)
    $("#tab2").addClass("on");
    $("#panel2").removeClass("slide-out");
	
	$("#panel1").hide();
	$("#panel2").hide();
#elseif("3"==$TAB || "3S"==$TAB)
	$("#tab3").addClass("on");
    $("#panel3").removeClass("slide-out");
	
	$("#panel1").hide();
	$("#panel2").show();
#end

 
#if("2S"==$TAB)
	errorBox("修改交易密码","成功！");
#end
#if("3S"==$TAB)
	errorBox("找回交易密码","成功！");
#end
	
});
</script>
</head>
<body>
<div class="container setting">
    <div id="header">
		<div class="topNav">
			<div class="container">
				<div class="b1"><a href="#" class="active">机构版</a><a href="#">家庭版</a></div>
				<div class="b2"><span>柔软的大牛</span><a href="${staticDomain}/family/settingAccount.htm"></a></div>
			</div>
		</div>
        <div class="container">
            <a href="#" class="logo"></a>
			<div class="nav">
				<a href="${staticDomain}/family/session.htm">我的账户</a>
				<a href="${staticDomain}/family/myufb.htm" class="active">幼富宝</a>
				<a href="#">缴费明细</a>
				<a href="${staticDomain}/family/helpAbout.htm">帮助中心</a>
			</div>
        </div>
    </div>
    <div class="body">
        <div class="inner clearfix">
            <div class="title">
                <h2 class="title-main">账户设置</h2>
            </div>
            <div class="side side-nav fl">
                <ul>
                    <li><a href="${staticDomain}/family/settingAccount.htm"><b class="icon01"></b>账户信息</a></li>
                    <li><a class="current" href="${staticDomain}/family/settingPassword.htm"><b class="icon02"></b>密码设置</a></li>
                    <li><a href="${staticDomain}/family/settingCard.htm"><b class="icon03"></b>银行卡管理</a></li>
                    <li><a href="${staticDomain}/family/settingAutoFund.htm"><b class="icon04"></b>自动理财设置</a></li>
                </ul>
            </div>
            <div class="main fr">
                <div class="setting-content">
                    <div class="tabs password-tabs clearfix">
                        <a class="btn fl" href="${staticDomain}/family/findPasswordStep1.htm">修改登录密码</a>
						#if($S_CUSTINFO.tradepwd)
                        <a id="tab2" class="btn tab fl" href="javascript:;">修改交易密码</a>
                        <a id="tab3" class="btn tab fl" href="javascript:;">忘记交易密码</a>
						#end
                    </div>
                    <div class="tips">交易密码： 为使用幼富通平台内涉及理财、缴费等资金交易时所需要输入的密码，不可与登录密码相同！</div>
                    <div class="panels password-panels">
					#if($S_CUSTINFO.tradepwd)
                        <div class="panel slide-out">
                            <form class="common-form" id="form-settingTradePwd" action="${ufbDomain}/family/settingTradePwd.htm" method="post">
								 ${refreshTools.genInputHtml()}
                                <ul>
                                    <li id="errMsg_password0"
                                      #if($errMsg_trade_password0)
                                      class="error"
                                      #end
                                      >
                                        <span class="form-title" >原交易密码</span>
                                        <input class="input-text" type="password" id="trade_password0" name="password0"  maxlength="20" value="$!{trade_password0}">
                                        <span class="tips-normal"></span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_trade_password0}</span>
                                    </li>
                                    <li id="errMsg_password1"
                                      #if($errMsg_trade_password1)
                                      class="error"
                                     #end
                                     >
                                        <span class="form-title">新交易密码</span>
                                        <input class="ipt-password1 input-text" id="trade_password1" name="password1" type="password" maxlength="20" value="$!{trade_password1}">
                                        <span class="tips-normal">6-20个大小写英文字母、符号或数字</span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_trade_password1}</span>
                                    </li>
                                    <li id="errMsg_password2"
                                        #if($errMsg_trade_password2)
                                        class="error"
                                        #end
                                        >
                                        <span class="form-title">交易密码确认</span>
                                        <input class="ipt-password2 input-text"  id="trade_password2" name="password2" maxlength="20" type="password" value="$!{trade_password2}">
                                        <span class="tips-normal">请再次输入密码</span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_trade_password2}</span>
                                    </li>
                                    <li>
                                        <input id="btn-settingTradePwd" class="input-button ok" type="button" value="提&nbsp;交">
                                    </li>
                                </ul>
                            </form>
                        </div>
                        <div class="panel slide-out">
                            <form class="common-form" id="form-settingTradePwd-back" action="${ufbDomain}/family/settingTradePwdBack.htm" method="post">
								${refreshTools.genInputHtml()}
                                <ul>
                                    <li>
                                        <span class="form-title">手机号</span>
                                        <div  > 
											<input type="hidden" id="mobileno" name="mobileno" value="$!{S_CUSTINFO.mobileno}"/>
										#if($S_CUSTINFO.mobileno)
            			                 #set($tailStr=$S_CUSTINFO.mobileno)
            			                 #set($start=$tailStr.substring(0,3))
										 #set($end=$tailStr.substring(7,11))
										 $start****$end
										#end
										</div>
                                    </li>
                                    <li id="errMsg_verifycode"
										#if($errMsg_verifycode)
											class="error"
										#end
										>
                                        <span class="form-title">验证码</span>
                                        <input id="verifycode" name="verifycode" class="ipt-code input-code" type="text" maxlength="4" value="$!{verifycode}">
                                        <span class="tips-normal">请输入验证码</span>
										<span class="form-verifyCode">
        								<img id="btn-verifycode" src="${staticDomain}/createImageservlet"+"?time="+(+new Date())" onclick="javascript:this.src=this.src+'?time='+(+new Date())"/>
        							    </span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_verifycode}</span>
                                    </li>
                                    <li id="errMsg_msgcode"
										#if($errMsg_msgcode)
											class="error"
										#end
										>
                                        <span class="form-title">手机验证码</span>
                                        <input id="msgcode" name="msgcode" class="ipt-phoneCode input-code" maxlength="6" type="text" value="$!{msgcode}">
                                        <span class="tips-normal">6位验证码</span>
                                        <input id="btn-getMsgCode" class="input-button" type="button" value="获取验证码">
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_msgcode}</span>
                                    </li>
                                    <li id="errMsg_password1_back"
										#if($errMsg_trade_password1_back)
											class="error"
										#end
										>
                                        <span class="form-title">新交易密码</span>
                                        <input id="trade_password1_back" name="password1" class="ipt-password1 input-text"  maxlength="20" type="password" value="$!{trade_password1_back}">
                                        <span class="tips-normal">6-20个大小写英文字母、符号或数字</span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_trade_password1_back}</span>
                                    </li>
                                    <li id="errMsg_password2_back"
										#if($errMsg_trade_password2_back)
											class="error"
										#end
										>
                                        <span class="form-title">交易密码确认</span>
                                        <input id="trade_password2_back" name="password2" class="ipt-password2 input-text"  maxlength="20" type="password" value="$!{trade_password2_back}">
                                        <span class="tips-normal">请再次输入密码</span>
                                        <span class="tips-check"><i class="icon"></i>$!{errMsg_trade_password2_back}</span>
                                    </li>
                                    <li>
                                        <input id="btn-settingTradePwd-back" class="input-button ok" type="button" value="提&nbsp;交">
                                    </li>
                                </ul>
                            </form>
                        </div>
					#end
                    </div>
                </div>
            </div>
        </div>
    </div>
	 <div class="footer footer-simple">
    <div class="inner clearfix">
        <div class="logo fl">
            <img src="${staticDomain}/static/family/images/logo_130x55.png">
        </div>
        <div class="info fl">
            <ul class="list">
                <li>微信服务号：UFUfund</li>
                <li>服务邮箱：<a href="mailto:service@ufufund.com">service@ufufund.com</a></li>
                <li>海富通产品：400-8840-099</li>
            </ul>
        </div>
        <div class="copyright fr">
            <ul class="list">
                <li>幼富通版权所有 ©2014</li>
                <li><a target="_blank" href="http://www.miitbeian.gov.cn/">沪ICP备14054347号</a></li>
            </ul>
        </div>
    </div>
</div>
</div>
<script src="${staticDomain}/static/family/scripts/load.js"></script>
<script src="${staticDomain}/static/family/scripts/register.js"></script>
</body>
</html>