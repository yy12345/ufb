<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ufufund.ufb.dao.BankMapper">



	<insert id="insterBankcardinfo" parameterType="com.ufufund.ufb.model.db.Bankcardinfo">
  	 <![CDATA[
	 	insert into bankcardinfo (
									serialid,
									custno,
									bankno,
									bankacco,
									bankaccodisplay,
									bankidtp,
									bankidno,
									bankidvaliddt,
									bankacnm,
									subbankno,
									banklongname,
									issign,
									signno,
									bankproexists,
									protocol_no,
									state,
									opendt,
									closedt,
									disorder,
									updatetimestamp)
		values (
					#{serialid,jdbcType=VARCHAR},
					#{custno,jdbcType=VARCHAR},
					#{bankno,jdbcType=VARCHAR},
					#{bankacco,jdbcType=VARCHAR},
					#{bankaccodisplay,jdbcType=VARCHAR},
					#{bankidtp,jdbcType=VARCHAR},
					#{bankidno,jdbcType=VARCHAR},
					#{bankidvaliddt,jdbcType=VARCHAR},
					#{bankacnm,jdbcType=VARCHAR},
					#{subbankno,jdbcType=VARCHAR},
                    #{banklongname,jdbcType=VARCHAR},
					#{issign,jdbcType=VARCHAR},
					#{signno,jdbcType=VARCHAR},
					#{bankproexists,jdbcType=VARCHAR},
					#{protocol_no,jdbcType=VARCHAR},
	                #{state,jdbcType=VARCHAR},
                    #{opendt,jdbcType=VARCHAR},
					#{closedt,jdbcType=VARCHAR},
					#{disorder,jdbcType=VARCHAR},
					sysdate()
	    )
	 ]]>
	</insert>

	<insert id="insterTradeaccoinfo" parameterType="com.ufufund.ufb.model.db.Tradeaccoinfo">
  	 <![CDATA[
	 	insert into tradeaccoinfo (
			  CUSTNO,
			  FUNDCORPNO,
			  BANKSERIALID,
			  TRADEACCO,
			  TRADEACCOST,
			  OPENDT,
			  CLOSEDT,
			  UPDATETIME				
		)
		values (
					
					#{custno,jdbcType=VARCHAR},
					#{fundcorpno,jdbcType=VARCHAR},
					#{bankserialid,jdbcType=VARCHAR},
					#{tradeacco,jdbcType=VARCHAR},
					#{tradeaccost,jdbcType=VARCHAR},
					#{opendt,jdbcType=VARCHAR},
					#{closedt,jdbcType=VARCHAR},
					sysdate()
	    )
	 ]]>
	</insert>


	<select id="getBankcardinfo" parameterType="com.ufufund.ufb.model.db.Bankcardinfo"
		resultType="com.ufufund.ufb.model.db.Bankcardinfo">

		SELECT
		bankcardinfo.SERIALID,
		bankcardinfo.CUSTNO,
		
		bankcardinfo.BANKNO,
		bankcardinfo.BANKACCO,
		bankcardinfo.BANKACCODISPLAY,
		bankcardinfo.BANKIDTP,
		bankcardinfo.BANKIDNO,
		bankcardinfo.BANKIDVALIDDT,
		bankcardinfo.BANKACNM,
		bankcardinfo.BANKMOBILE,
		bankcardinfo.SUBBANKNO,
		bankcardinfo.BANKLONGNAME,
		bankcardinfo.ISSIGN,
		bankcardinfo.SIGNNO,
		bankcardinfo.BANKPROEXISTS,
		bankcardinfo.PROTOCOL_NO,
		bankcardinfo.STATE,
		bankcardinfo.OPENDT,
		bankcardinfo.CLOSEDT,
		bankcardinfo.DISORDER
		FROM
		bankcardinfo
		WHERE
		<if test="custno != null and custno !=''">
			bankcardinfo.CUSTNO = #{custno,jdbcType=VARCHAR} AND
		</if>
		bankcardinfo.STATE &lt;&gt; 'N'
	</select>
	
	<select id="getBankCardWithTradeAccoList" parameterType="String" resultType="BankCardWithTradeAcco">
		select
			b.SERIALID,
			b.CUSTNO,
			b.BANKNO,
			b.BANKACCO,
			b.BANKACCODISPLAY,
			b.BANKIDTP,
			b.BANKIDNO,
			b.BANKIDVALIDDT,
			b.BANKACNM,
			b.BANKMOBILE,
			b.SUBBANKNO,
			b.BANKLONGNAME,
			b.ISSIGN,
			b.SIGNNO,
			b.BANKPROEXISTS,
			b.PROTOCOL_NO,
			b.STATE,
			b.OPENDT,
			b.CLOSEDT,
			b.DISORDER,
			b.MAINFLAG,
			b.UPDATETIMESTAMP,
			t.TRADEACCO,
			t.FUNDCORPNO
		from tradeaccoinfo t, bankcardinfo b
		where 
			b.custno = #{custno,jdbcType=VARCHAR}
			and b.state = #{state,jdbcType=VARCHAR}
			and t.tradeaccost = 'N' 
			and b.serialid  = t.bankserialid
		order by b.MAINFLAG DESC
	</select>
	
	<update id="setBankCardMainFlag" parameterType="String">
		UPDATE bankcardinfo T1
			SET 
			T1.MAINFLAG = #{mainflag,jdbcType=VARCHAR}
	     WHERE 
	     	T1.CUSTNO = #{custno,jdbcType=VARCHAR}
	     	<if test="bankacco != null and bankacco !=''" >
	     	and T1.BANKACCO = #{bankacco,jdbcType=VARCHAR}
	     	</if>
	</update>
	
	<update id="unbindBankCard" parameterType="String">
		UPDATE bankcardinfo T1
			SET 
			T1.STATE = #{state,jdbcType=VARCHAR}
	     WHERE 
	     	T1.CUSTNO = #{custno,jdbcType=VARCHAR}
	     	and T1.BANKACCO = #{bankacco,jdbcType=VARCHAR}
	</update>

	<select id="getBankcardinfoSequence" parameterType="java.lang.String"
		resultType="java.lang.String">
	<![CDATA[
		select getSequence('BANKCARDINFO_SEQ')
	]]>
	</select>
	
	<select id="getTradeaccoinfo" parameterType="com.ufufund.ufb.model.db.Tradeaccoinfo" resultType="com.ufufund.ufb.model.db.Tradeaccoinfo">
		SELECT
			tradeaccoinfo.TRADEACCOID,
			tradeaccoinfo.CUSTNO,
			tradeaccoinfo.FUNDCORPNO,
			tradeaccoinfo.BANKSERIALID,
			tradeaccoinfo.TRADEACCO,
			tradeaccoinfo.TRADEACCOST,
			tradeaccoinfo.OPENDT,
			tradeaccoinfo.CLOSEDT,
			tradeaccoinfo.UPDATETIME
		FROM
			tradeaccoinfo
		WHERE 
		<if test="accoid != null and accoid !=''" >
			tradeaccoinfo.TRADEACCOID = #{accoid,jdbcType=INTEGER} AND
		</if>
  		<if test="custno != null and custno !=''" >
  		 	tradeaccoinfo.CUSTNO = #{custno,jdbcType=VARCHAR} AND
  		</if>
  		<if test="fundcorpno != null and fundcorpno !=''" >
  			tradeaccoinfo.FUNDCORPNO = #{fundcorpno,jdbcType=VARCHAR} AND
  		</if>
  		<if test="bankserialid != null and bankserialid !=''" >
  		 	tradeaccoinfo.BANKSERIALID = #{bankserialid,jdbcType=VARCHAR} AND
  		</if>
	     	autotrade.STATE &lt;&gt; 'C'
  	</select>
  	
  	<select id="isTradeaccoinfoBind" parameterType="com.ufufund.ufb.model.action.cust.OpenAccountAction" resultType="java.lang.String">
		SELECT
			tradeaccoinfo.TRADEACCOID
		FROM
			tradeaccoinfo, bankcardinfo
		WHERE 
			tradeaccoinfo.BANKSERIALID = bankcardinfo.SERIALID
  		<if test="custno != null and custno !=''" >
  		 	AND tradeaccoinfo.CUSTNO = #{custno,jdbcType=VARCHAR}
  		</if>
  		<if test="fundcorpno != null and fundcorpno !=''" >
  			AND tradeaccoinfo.FUNDCORPNO = #{fundcorpno,jdbcType=VARCHAR}
  		</if>
  		<if test="bankno != null and bankno !=''" >
  		 	AND bankcardinfo.BANKNO = #{bankno,jdbcType=VARCHAR}
  		</if>
  		<if test="bankacco != null and bankacco !=''" >
  		 	AND bankcardinfo.BANKACCO = #{bankacco,jdbcType=VARCHAR}
  		</if>
  	</select>

</mapper>
